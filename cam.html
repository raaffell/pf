<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cermin Instant - AI Gesture</title>
<!-- Memuat Library MediaPipe Hands -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>

<link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --accent:#ff46a3;
  --bg1:#fcb6e2;
  --bg2:#8ec0f9;
  --glass:rgba(255,255,255,0.25);
  --glass-border:1px solid rgba(255,255,255,0.15);
  --ai-color:#00e676;
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  min-height:100vh;
  background:linear-gradient(135deg,var(--bg1),var(--bg2));
  display:flex;
  justify-content:center;
  padding:20px;
  font-family:'Poppins',sans-serif;
  color:#fff;
}
.app{
  width:100%;
  max-width:1100px;
  display:grid;
  grid-template-columns:1fr 380px;
  gap:25px;
}
@media(max-width:900px){.app{grid-template-columns:1fr;}}

/* Card Styles */
.mirror-card{
  background:var(--glass);
  backdrop-filter:blur(12px);
  -webkit-backdrop-filter:blur(12px);
  padding:24px;
  border-radius:24px;
  box-shadow:0 12px 40px rgba(0,0,0,0.2);
  border:var(--glass-border);
  display:flex; flex-direction:column;
}

.mirror-head{
  margin-bottom:20px;
  text-align:center;
}
.title{
  font-family:'Pacifico',cursive;
  font-size:36px;
  background:linear-gradient(90deg,#ff46a3,#fff);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  margin-bottom:5px;
}
.sub{
  font-size:15px;
  opacity:0.9;
  font-weight:400;
}

/* Video Area */
.video-wrap{
  position:relative;
  border-radius:20px;
  overflow:hidden;
  border:4px solid rgba(255,255,255,0.2);
  background:#000;
  aspect-ratio:4/3;
  box-shadow:inset 0 0 20px rgba(0,0,0,0.5);
}
video{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
  transform:scaleX(-1); /* Default mirror */
}
.shutter{
  position:absolute; inset:0;
  background:#fff;
  opacity:0;
  pointer-events:none;
}
.shutter.flash{animation:flash .3s ease-out forwards}
@keyframes flash{0%{opacity:0}10%{opacity:1}100%{opacity:0}}

/* Capture Button */
.capture-btn{
  position:absolute;
  bottom:20px;
  left:50%;
  transform:translateX(-50%); /* Posisi tengah */
  width:64px;
  height:64px;
  border-radius:50%;
  background:#fff;
  border:4px solid rgba(0,0,0,0.1);
  color:var(--accent);
  font-size:28px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  box-shadow:0 4px 15px rgba(0,0,0,0.3);
  transition:transform 0.1s;
}
.capture-btn:active{transform:translateX(-50%) scale(0.9);}
.capture-btn:disabled{opacity:0.5; cursor:not-allowed;}

/* Controls Area */
.controls{
  display:flex;
  gap:10px;
  align-items:center;
  margin-top:20px;
  flex-wrap:wrap;
  justify-content:center;
}
select, button{
  appearance:none;
  border:0;
  padding:10px 16px;
  border-radius:14px;
  background:rgba(255,255,255,0.9);
  color:#444;
  font-family:'Poppins',sans-serif;
  font-weight:600;
  font-size:13px;
  cursor:pointer;
  transition:all 0.2s;
  box-shadow:0 2px 5px rgba(0,0,0,0.1);
}
select:hover, button:not(.capture-btn):hover{background:#fff; transform:translateY(-2px);}

.ghost{background:rgba(0,0,0,0.2); color:#fff; border:1px solid rgba(255,255,255,0.2);}
.ghost:hover{background:rgba(0,0,0,0.4);}

/* AI Button Style */
.btn-ai{
  background: linear-gradient(135deg, #00b09b, #96c93d);
  color: white;
  border: 1px solid rgba(255,255,255,0.3);
}
.btn-ai.active{
  background: linear-gradient(135deg, #ff46a3, #ff80b3);
  box-shadow: 0 0 15px var(--accent);
  border-color: #fff;
}
.btn-ai .status-dot{
  display:inline-block; width:8px; height:8px; background:#fff; border-radius:50%; margin-right:5px;
}
.btn-ai.loading .status-dot{background:#ffeb3b; animation:blink 1s infinite;}
@keyframes blink{50%{opacity:0.5}}

/* Countdown */
#countdown{
  position:absolute;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  font-size:80px;
  font-weight:700;
  color:#fff;
  text-shadow:0 4px 10px rgba(0,0,0,0.5);
  pointer-events:none;
  display:none;
}

/* Sidebar Gallery */
.side-card{
  background:rgba(255,255,255,0.15);
  backdrop-filter:blur(10px);
  padding:20px;
  border-radius:20px;
  border:var(--glass-border);
  display:flex; flex-direction:column;
  height: fit-content;
}
.side-head{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:15px;
  padding-bottom:10px;
  border-bottom:1px solid rgba(255,255,255,0.1);
}
.gallery{
  display:flex;
  flex-direction:column;
  gap:12px;
  max-height:60vh;
  overflow-y:auto;
  padding:4px;
}
.gallery::-webkit-scrollbar{width:6px;}
.gallery::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.3);border-radius:10px;}

.thumb-row{
  display:flex;
  gap:10px;
  background:rgba(0,0,0,0.2);
  padding:8px;
  border-radius:12px;
  align-items:center;
  transition:background 0.2s;
}
.thumb-row:hover{background:rgba(0,0,0,0.3);}
.thumb-img{
  width:80px;
  height:60px;
  border-radius:8px;
  object-fit:cover;
  cursor:pointer;
  border:2px solid transparent;
}
.thumb-img:hover{border-color:var(--accent);}
.thumb-info{
  flex:1;
  font-size:13px;
  font-weight:600;
  color:#fff;
}
.btn-icon{
  padding:6px;
  width:32px;
  height:32px;
  display:flex;
  align-items:center;
  justify-content:center;
  border-radius:8px;
  font-size:14px;
  margin-left:5px;
}
.del-btn{background:rgba(255,70,163,0.2); color:#ff8cc8;}
.del-btn:hover{background:#ff46a3; color:#fff;}

.empty{opacity:0.6;padding:20px;text-align:center;font-style:italic;font-size:14px;}

/* Modal */
.modal{position:fixed;inset:0;display:none;justify-content:center;align-items:center;background:rgba(0,0,0,0.8);z-index:100;backdrop-filter:blur(5px);}
.modal.show{display:flex;animation:fadeIn 0.2s ease-out;}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.modal-card{max-width:90%;width:auto;background:#111;padding:10px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,0.5);border:1px solid #333;}
.modal-card img{max-height:80vh;max-width:100%;border-radius:12px;display:block;}
.modal-actions{display:flex;gap:10px;justify-content:center;margin-top:15px;}

/* AI Indicator Overlay */
.ai-badge{
  position: absolute; top: 15px; right: 15px;
  background: rgba(0, 230, 118, 0.2);
  border: 1px solid var(--ai-color);
  color: var(--ai-color);
  padding: 5px 10px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: bold;
  display: flex;
  align-items: center;
  gap: 5px;
  display: none;
}
.ai-badge.show{display:flex;}
.ai-icon{font-size:14px;}
</style>
</head>
<body>

<div class="app">
  <!-- Kamera Section -->
  <div class="mirror-card">
    <div class="mirror-head">
      <div class="title">Cermin Instant AI</div>
      <div class="sub">Cobalah fitur "‚úã Mode Tangan"</div>
    </div>

    <div class="video-wrap" id="videoWrap">
      <video id="video" autoplay muted playsinline></video>
      <div class="shutter" id="shutter"></div>
      <div id="countdown"></div>
      
      <!-- Indikator AI -->
      <div class="ai-badge" id="aiBadge">
        <span class="ai-icon">‚úã</span> <span id="aiText">Mendeteksi...</span>
      </div>

      <button class="capture-btn" id="captureBtn">üì∏</button>
    </div>

    <div class="controls">
      <select id="timerSelect">
        <option value="0">üöÄ Langsung</option>
        <option value="3" selected>‚è± 3 detik</option>
        <option value="5">‚è± 5 detik</option>
        <option value="10">‚è± 10 detik</option>
      </select>

      <select id="filterSelect"></select>

      <button id="switchCamBtn">üîÑ Kamera</button>
      
      <select id="mirrorSelect">
        <option value="mirror">ü™û Mirror</option>
        <option value="no-mirror">‚û°Ô∏è Normal</option>
      </select>
      
      <!-- Tombol AI Baru -->
      <button id="gestureBtn" class="btn-ai">
        <span class="status-dot"></span> ‚úã Mode Tangan
      </button>

      <button id="clearBtn" class="ghost">üóë Bersihkan</button>
      <button id="downloadAllBtn" class="ghost">‚¨áÔ∏è Simpan</button>
    </div>
  </div>

  <!-- Gallery Section -->
  <div class="side-card">
    <div class="side-head">
      <div><strong>Galeri Foto</strong></div>
      <small id="galleryCount" style="opacity:0.8">0 / 5</small>
    </div>
    <div class="gallery" id="gallery">
      <div class="empty">Belum ada foto.</div>
    </div>
  </div>
</div>

<!-- Modal Preview -->
<div class="modal" id="modal">
  <div class="modal-card">
    <img id="modalImg" src="" alt="Preview">
    <div class="modal-actions">
      <button id="modalDownload">‚¨áÔ∏è Simpan</button>
      <button id="modalDelete" class="ghost" style="color:#ff6b6b; border-color:#ff6b6b;">‚úñ Hapus</button>
      <button id="modalClose" class="ghost">Tutup</button>
    </div>
  </div>
</div>

<script>
// --- KONFIGURASI & VARIABEL ---
let video = document.getElementById('video');
let countdownEl = document.getElementById('countdown');
let shutter = document.getElementById('shutter');
let captureBtn = document.getElementById('captureBtn');
let timerSelect = document.getElementById('timerSelect');
let filterSelect = document.getElementById('filterSelect');
let mirrorSelect = document.getElementById('mirrorSelect');
let gallery = document.getElementById('gallery');
let clearBtn = document.getElementById('clearBtn');
let downloadAllBtn = document.getElementById('downloadAllBtn');
let galleryCount = document.getElementById('galleryCount');
let modal = document.getElementById('modal');
let modalImg = document.getElementById('modalImg');
let modalDownload = document.getElementById('modalDownload');
let modalDelete = document.getElementById('modalDelete');
let modalClose = document.getElementById('modalClose');
let switchCamBtn = document.getElementById('switchCamBtn');
let gestureBtn = document.getElementById('gestureBtn');
let aiBadge = document.getElementById('aiBadge');
let aiText = document.getElementById('aiText');

let galleryList = []; 
let currentModalIndex = -1;
let currentStream = null;
let useFrontCamera = true;
let mirrorMode = true;
const MAX_PHOTOS = 5;

// --- VARIABEL AI / GESTURE ---
let hands = null;
let isGestureModeActive = false;
let gestureTimer = null;
let isCountingDown = false;
let framesWithOpenHand = 0; // Debounce (mencegah false trigger)

// --- DAFTAR FILTER ---
const filters = [
  {name: "‚ú® Normal", value: "none"},
  {name: "‚ö´ Hitam Putih", value: "grayscale(100%)"},
  {name: "ü•Ä Sepia", value: "sepia(100%)"},
  {name: "üåô Negatif", value: "invert(100%)"},
  {name: "üíñ Beauty Soft", value: "contrast(110%) brightness(110%) saturate(110%)"},
  {name: "üåà Warna Cerah", value: "saturate(160%)"},
  {name: "üå∏ Pink Soft", value: "contrast(110%) brightness(105%) saturate(120%) hue-rotate(-10deg)"},
  {name: "‚ú® Film Grain", value: "grain"}, 
  {name: "üåÖ Vintage", value: "contrast(120%) sepia(30%) saturate(130%)"},
  {name: "üé¨ Sinema", value: "contrast(130%) saturate(80%) brightness(90%)"},
  {name: "‚ùÑÔ∏è Dingin", value: "hue-rotate(180deg) contrast(120%)"}
];

filters.forEach(f => {
  const opt = document.createElement('option');
  opt.textContent = f.name;
  opt.value = f.value;
  filterSelect.appendChild(opt);
});

// --- FUNGSI KAMERA ---
async function startCamera(){
  if(currentStream) currentStream.getTracks().forEach(track => track.stop());
  try{
    const constraints = {
      video: {
        facingMode: useFrontCamera ? 'user' : 'environment',
        width: { ideal: 1280 },
        height: { ideal: 720 }
      }
    };
    const stream = await navigator.mediaDevices.getUserMedia(constraints);
    currentStream = stream;
    video.srcObject = stream;
    applyMirror();
    await video.play();
    
    // Jika mode aktif, pastikan AI tetap jalan
    if(isGestureModeActive && hands){
        startAiLoop();
    }
  } catch(err){
    console.error(err);
    alert("Gagal mengakses kamera. Pastikan izin kamera diberikan.");
  }
}

function applyMirror(){
  // Video Mirror
  if(mirrorMode){
    video.style.transform = "scaleX(-1)";
  } else {
    video.style.transform = "scaleX(1)";
  }
}

switchCamBtn.addEventListener('click', () => {
  useFrontCamera = !useFrontCamera;
  startCamera();
});

mirrorSelect.addEventListener('change', () => {
  mirrorMode = mirrorSelect.value === 'mirror';
  applyMirror();
});

filterSelect.addEventListener('change', () => {
  applyFilterToVideo();
});

function applyFilterToVideo(){
  const val = filterSelect.value;
  if(val === 'grain'){
    video.style.filter = "contrast(110%) brightness(105%)";
  } else {
    video.style.filter = val;
  }
}

// --- LOGIKA AI / TANGAN ---

// Inisialisasi MediaPipe Hands
function initHands() {
  if(hands) return; // Sudah diinisialisasi

  gestureBtn.classList.add('loading');
  aiText.textContent = "Memuat Model AI...";

  hands = new Hands({locateFile: (file) => {
    return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
  }});

  hands.setOptions({
    maxNumHands: 1,
    modelComplexity: 1,
    minDetectionConfidence: 0.7,
    minTrackingConfidence: 0.7
  });

  hands.onResults(onHandResults);

  // Setelah loading selesai (simulasi delay pertama)
  hands.on('initialize', () => {
     console.log("AI Ready");
  });
}

function startAiLoop(){
  if(!isGestureModeActive || !video.videoWidth) return;
  
  // Kirim frame video ke AI
  hands.send({image: video}).then(() => {
    if(isGestureModeActive){
      requestAnimationFrame(startAiLoop);
    }
  }).catch(err => {
    console.warn("AI Frame skip", err);
    if(isGestureModeActive) requestAnimationFrame(startAiLoop);
  });
}

function onHandResults(results) {
  // Reset state jika sedang hitung mundur manual atau AI
  if (isCountingDown) return;

  if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
    const landmarks = results.multiHandLandmarks[0];
    
    // Cek gestur "Telapak Tangan Terbuka"
    // Logika: Tips jari (8,12,16,20) harus berada di atas (y lebih kecil) dari sendi (6,10,14,18)
    const isIndexUp = landmarks[8].y < landmarks[6].y;
    const isMiddleUp = landmarks[12].y < landmarks[10].y;
    const isRingUp = landmarks[16].y < landmarks[14].y;
    const isPinkyUp = landmarks[20].y < landmarks[18].y;

    // Thumb agak tricky, kita abaikan untuk kesederhanaan, fokus 4 jari
    if (isIndexUp && isMiddleUp && isRingUp && isPinkyUp) {
      framesWithOpenHand++;
      
      // Jika tangan terdeteksi stabil selama 5 frame (mencegah salah baca kilat)
      if (framesWithOpenHand > 5) {
        aiBadge.classList.add('show');
        aiText.textContent = "‚úã Terdeteksi! Tahan...";
        
        // Jika belum mulai hitung mundur
        if (!gestureTimer) {
            startGestureCountdown();
        }
      }
    } else {
      resetGestureDetection();
    }
  } else {
    resetGestureDetection();
  }
}

function resetGestureDetection() {
  framesWithOpenHand = 0;
  if (gestureTimer) {
    clearTimeout(gestureTimer);
    gestureTimer = null;
  }
  aiBadge.classList.remove('show');
  countdownEl.style.display = 'none';
}

function startGestureCountdown() {
  isCountingDown = true;
  let count = 3;
  
  // Tampilkan Countdown di layar
  countdownEl.style.display = 'block';
  countdownEl.textContent = count;
  aiText.textContent = `Foto otomatis: ${count}`;

  gestureTimer = setInterval(() => {
    count--;
    if (count > 0) {
      countdownEl.textContent = count;
      aiText.textContent = `Foto otomatis: ${count}`;
    } else {
      // Waktunya Foto
      clearInterval(gestureTimer);
      gestureTimer = null;
      countdownEl.style.display = 'none';
      aiBadge.classList.remove('show');
      
      doCapture(); // Panggil fungsi foto yang sudah ada
      
      // Cooldown agar tidak langsung foto lagi
      isCountingDown = false;
      setTimeout(() => {
        if(isGestureModeActive) startAiLoop(); // Lanjut deteksi
      }, 2000);
    }
  }, 1000);
}

// Toggle Button AI
gestureBtn.addEventListener('click', async () => {
  isGestureModeActive = !isGestureModeActive;
  
  if (isGestureModeActive) {
    gestureBtn.classList.add('active');
    gestureBtn.innerHTML = '<span class="status-dot" style="background:#fff"></span> ‚úã AI Aktif';
    
    if(!hands) initHands();
    
    // Mulai loop jika video ready
    if(video.readyState >= 2){
        startAiLoop();
    } else {
        video.onloadeddata = () => startAiLoop();
    }
    
  } else {
    gestureBtn.classList.remove('active');
    gestureBtn.innerHTML = '<span class="status-dot"></span> ‚úã Mode Tangan';
    gestureBtn.classList.remove('loading');
    resetGestureDetection();
  }
});


// --- PROSES FOTO (TANGKAP LAYAR) ---
captureBtn.addEventListener('click', () => {
  if(isGestureModeActive && isCountingDown) return; // Jangan ganggu jika AI sedang bekerja

  let t = parseInt(timerSelect.value, 10);
  
  if(t === 0){
    doCapture();
    return;
  }

  // Timer Logic Manual
  captureBtn.disabled = true;
  captureBtn.style.opacity = "0.5";
  countdownEl.style.display = "block";
  countdownEl.textContent = t;
  
  // Pause AI sementara agar tidak konflik
  let wasAiActive = isGestureModeActive;
  if(wasAiActive) isGestureModeActive = false;

  let timerInterval = setInterval(() => {
    t--;
    if(t > 0){
      countdownEl.textContent = t;
    } else {
      clearInterval(timerInterval);
      countdownEl.style.display = "none";
      doCapture();
      captureBtn.disabled = false;
      captureBtn.style.opacity = "1";
      
      // Kembalikan AI jika sebelumnya aktif
      if(wasAiActive){
        isGestureModeActive = true;
        startAiLoop();
      }
    }
  }, 1000);
});

function doCapture(){
  // Pause AI sebentar agar proses capture tidak lag
  const wasAiActive = isGestureModeActive;
  isGestureModeActive = false;

  shutter.classList.remove('flash');
  void shutter.offsetWidth; 
  shutter.classList.add('flash');

  const w = video.videoWidth || 640;
  const h = video.videoHeight || 480;
  const canvas = document.createElement('canvas');
  canvas.width = w;
  canvas.height = h;
  const ctx = canvas.getContext('2d');

  if(mirrorMode){
    ctx.translate(w, 0);
    ctx.scale(-1, 1);
  }

  const selectedFilter = filterSelect.value;
  
  if(selectedFilter === 'grain'){
    ctx.filter = "contrast(110%) brightness(105%) saturate(100%)";
    ctx.drawImage(video, 0, 0, w, h);
    
    const imgData = ctx.getImageData(0,0,w,h);
    const data = imgData.data;
    for(let i=0; i < data.length; i+=4){
      const noise = (Math.random() - 0.5) * 40;
      data[i] = Math.min(255, Math.max(0, data[i] + noise));
      data[i+1] = Math.min(255, Math.max(0, data[i+1] + noise));
      data[i+2] = Math.min(255, Math.max(0, data[i+2] + noise));
    }
    ctx.putImageData(imgData, 0, 0);
  } else {
    ctx.filter = selectedFilter;
    ctx.drawImage(video, 0, 0, w, h);
  }

  const dataUrl = canvas.toDataURL('image/png');
  addToGallery(dataUrl);

  // Resume AI setelah capture selesai
  setTimeout(() => {
      if(wasAiActive){
          isGestureModeActive = true;
          startAiLoop();
      }
  }, 500);
}

// --- MANAJEMEN GALERI ---
function renderGallery(){
  gallery.innerHTML = ''; 
  galleryCount.textContent = `${galleryList.length} / ${MAX_PHOTOS}`;

  if(galleryList.length === 0){
    gallery.innerHTML = '<div class="empty">Belum ada foto.</div>';
    return;
  }

  galleryList.forEach((dataUrl, index) => {
    const row = document.createElement('div');
    row.className = 'thumb-row';

    const img = document.createElement('img');
    img.src = dataUrl;
    img.className = 'thumb-img';
    img.onclick = () => openModal(index);

    const info = document.createElement('div');
    info.className = 'thumb-info';
    info.textContent = `Foto ${index + 1}`;

    const btnDel = document.createElement('button');
    btnDel.className = 'btn-icon del-btn';
    btnDel.innerHTML = '‚úñ';
    btnDel.title = "Hapus foto ini";
    btnDel.onclick = (e) => {
      e.stopPropagation();
      deletePhoto(index);
    };

    row.appendChild(img);
    row.appendChild(info);
    row.appendChild(btnDel);
    gallery.appendChild(row);
  });
}

function addToGallery(data){
  if(galleryList.length >= MAX_PHOTOS){
    galleryList.shift();
  }
  galleryList.push(data);
  renderGallery();
}

function deletePhoto(index){
  if(index < 0 || index >= galleryList.length) return;
  galleryList.splice(index, 1);
  renderGallery();
  if(modal.classList.contains('show')){
    modal.classList.remove('show');
  }
}

clearBtn.addEventListener('click', () => {
  if(galleryList.length === 0) return;
  if(confirm('Yakin ingin menghapus semua foto di galeri?')){
    galleryList = [];
    renderGallery();
  }
});

downloadAllBtn.addEventListener('click', () => {
  if(galleryList.length === 0) return alert('Galeri kosong!');
  galleryList.forEach((url, i) => {
    setTimeout(() => {
      const link = document.createElement('a');
      link.href = url;
      link.download = `cermin_instant_${i+1}.png`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }, i * 300);
  });
});

// --- MODAL PREVIEW ---
function openModal(index){
  if(index < 0 || index >= galleryList.length) return;
  currentModalIndex = index;
  modalImg.src = galleryList[index];
  modal.classList.add('show');
}

modalClose.addEventListener('click', () => modal.classList.remove('show'));
modal.addEventListener('click', (e) => {
  if(e.target === modal) modal.classList.remove('show');
});

modalDownload.addEventListener('click', () => {
  if(currentModalIndex === -1) return;
  const link = document.createElement('a');
  link.href = galleryList[currentModalIndex];
  link.download = `cermin_instant_${currentModalIndex+1}.png`;
  link.click();
});

modalDelete.addEventListener('click', () => {
  if(currentModalIndex === -1) return;
  deletePhoto(currentModalIndex);
});

// --- INIT ---
startCamera();
applyFilterToVideo();
</script>

</body>
</html>
